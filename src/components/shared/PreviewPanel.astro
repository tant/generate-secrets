---
// PreviewPanel.astro: Shows .env preview and actions
const { preview = "" } = Astro.props as { preview?: string };

---
<div class="card bg-base-100 shadow-md p-4 mb-4">
  <div class="mb-2 font-semibold">Preview .env</div>
  <textarea class="textarea textarea-bordered w-full h-32 font-mono" readonly id="envPreview" aria-label=".env preview">{preview}</textarea>
  <div class="flex gap-2 mt-2">
  <button class="btn btn-primary btn-sm" id="copyEnvBtn" aria-label="Copy .env">Copy .env</button>
  <button class="btn btn-ghost btn-sm" id="downloadEnvBtn" aria-label="Download .env">Download .env</button>
  <button class="btn btn-ghost btn-sm" id="selectAllEnvBtn" aria-label="Select all">Select all</button>
  </div>
  <div class="text-xs mt-2 opacity-60">All processing is done in your browser. No data is uploaded.</div>
  <script type="module">
    const copyBtn = document.getElementById('copyEnvBtn');
    const downloadBtn = document.getElementById('downloadEnvBtn');
    const selectAllBtn = document.getElementById('selectAllEnvBtn');
    const textarea = document.getElementById('envPreview');
    copyBtn?.addEventListener('click', () => {
      if (textarea) navigator.clipboard.writeText(textarea.value);
    });
    downloadBtn?.addEventListener('click', () => {
      if (textarea) {
        const blob = new Blob([textarea.value], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = '.env';
        a.click();
        URL.revokeObjectURL(url);
      }
    });
    selectAllBtn?.addEventListener('click', () => {
      if (textarea) {
        textarea.select();
        document.execCommand('copy');
      }
    });
  </script>
</div>
